  Quantum ESPRESSO Utility Scripts

  This repository was intend to give an accurate result of dipole moment of charged molecules. It contains two Python scripts designed to assist with Quantum ESPRESSO (QE) calculations and molecular file conversions: **`cal_dipole.py`** and **`gjf2vasp.py`**. Below are detailed descriptions, prerequisites, and usage instructions for each script.

  ---

  ## `cal_dipole.py`

  ### Overview
  `cal_dipole.py` computes the dipole moment of a molecule using charge density data from Quantum ESPRESSO (QE) calculations. It processes an output file from QE's post-processing tool (`pp.x`), calculates the dipole moment with a chosen reference point (cell center or center of mass), and generates:
  - An XYZ file of the molecular structure.
  - A VMD (Visual Molecular Dynamics) script to visualize the dipole moment.

  ### Prerequisites
  - **Python Packages**:
    - **ASE (Atomic Simulation Environment)**: For managing atomic structures.
    - **NumPy**: For numerical operations.
    - Install them with:
      ```bash
      pip install ase numpy
      ```
  - **Quantum ESPRESSO**: Requires output from the `pp.x` tool.
  - **VMD**: Optional, for visualization.

  ### Input File
  The script uses a file generated by QE's `pp.x`, typically named **`Bader_<molecule_name>`** (e.g., `Bader_r-p-MBA`). This file contains charge density and atomic data. Note that you should run relaxation in `pw.x` before this `pp.x` post processing program and set  `vdw_corr = 'DFT-D3' `, `assume_isolated='mt'`,  `tot_charge = +1` in `&system` to set up non-periodic simulation.

  #### Generating the Input File
  Run QE's `pp.x` with this example input:
  ```plaintext
   &INPUTPP
     prefix = 'BTO',
     outdir = './',
     filplot = 'Bader_r-p-MBA',
     plot_num = 0,
   /
   &PLOT
     nfile = 1,
     iflag = 3,
     output_format = 6,
     fileout = 'Bader_r-p-MBA.cube',
   /
  ```
  - **Key Parameters**:
    - `prefix`: Matches your QE calculation prefix.
    - `outdir`: Directory of QE output files.
    - `filplot`: Intermediate file name (used by the script).
    - `plot_num = 0`: Processes charge density.
    - `output_format = 6`: Creates a Gaussian cube file (though only the text file is needed).

  Execute with:
  ```bash
  pp.x < input_file.in > output_file.out
  ```
  This generates `Bader_<molecule_name>` and `Bader_<molecule_name>.cube`. Only the former is required.

  ### Usage
  1. **Set the Molecule Name**:
     - Edit the `name` variable in the `main()` function (e.g., `name = 'r-p-MBA'` for `Bader_r-p-MBA`).

  2. **Choose Reference Point**:
     - Options: `'cell_center'` or `'mass_center'` (default).
     - Modify `ref_point` in `main()`.

  3. **Run the Script**:
     - Place `cal_dipole.py` and `Bader_<molecule_name>` in the same directory.
     - Execute:
       ```bash
       python cal_dipole.py
       ```

  4. **Output Files**:
     - **`<molecule_name>.xyz`**: Molecular structure with element symbols.
     - **`view_<molecule_name>.vmd`**: VMD script to visualize the dipole moment.
     - **`view_<molecule_name>.bat`**: Windows batch file to launch VMD (edit `vmd_path` if needed).

  ### Example
  For `Bader_r-p-MBA`:
  1. Set `name = 'r-p-MBA'` in the script.
  2. Run:
     ```bash
     python cal_dipole.py
     ```
  3. Outputs:
     - `r-p-MBA.xyz`
     - `view_r-p-MBA.vmd`
     - `view_r-p-MBA.bat`
  4. Visualize:
     - Windows: Double-click `view_r-p-MBA.bat`.
     - Linux/Mac: `vmd -e view_r-p-MBA.vmd`.

  ### Customization
  - **Arrow Style**: Adjust `arrow_length_scale`, `arrow_radius`, `arrow_body`, and `arrow_color` in `main()`.
  - **VMD Path**: Update `vmd_path` in `write_vmd_script()` to your VMD installation.

  ---

  ## `gjf2vasp.py`

  ### Overview
  `gjf2vasp.py` converts Gaussian input files (`.gjf`) into VASP POSCAR, XSF, or CIF formats. It reads coordinates, computes cell parameters with an expansion coefficient, centers the molecule, and outputs the structure.

  ### Prerequisites
  - **Python Packages**:
    - **NumPy**: For numerical operations.
    - Install with:
      ```bash
      pip install numpy
      ```

  ### Usage
  The script uses command-line arguments for flexibility.

  #### Command-Line Options
  - **`input`**: GJF file to convert (optional with `--all`).
  - **`--all`, `-a`**: Convert all `.gjf` files in the directory.
  - **`--format`, `-o`**: Output format:
    - `vasp` (default)
    - `xsf`
    - `cif`
  - **`--expand`, `-e`**: Cell size expansion coefficient (default: 5.0 Ã…).
  - **`--fractional`, `-f`**: Use fractional coordinates for VASP (default: Cartesian).

  #### Examples
  1. **Single GJF to VASP**:
     ```bash
     python gjf2vasp.py input.gjf
     ```
     - Output: `input.vasp`

  2. **All GJF Files to XSF**:
     ```bash
     python gjf2vasp.py --all --format xsf
     ```
     - Output: `<filename>.xsf` for each file.

  3. **GJF to CIF with Larger Cell**:
     ```bash
     python gjf2vasp.py input.gjf --format cif --expand 10.0
     ```
     - Output: `input.cif`

  ### Output Details
  - **VASP POSCAR**: Lattice vectors, atom types, coordinates (Cartesian or fractional).
  - **XSF**: Lattice vectors and coordinates with atomic numbers.
  - **CIF**: Crystallographic data with fractional coordinates.

  ---

  ## General Notes
  - **Input Validation**:
    - For `cal_dipole.py`, match `name` to the `Bader_<molecule_name>` file.
    - For `gjf2vasp.py`, ensure GJF files follow standard Gaussian format.
  - **Compatibility**: Designed for isolated molecules; periodic systems may require tweaks.
  - **Errors**: Check console for issues with files or dependencies.
